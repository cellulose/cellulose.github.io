<!DOCTYPE html>
<html>
  <head>
    <title>Hub</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="css/elixir.css" type="text/css" media="screen" charset="utf-8" />
    <script type="text/javascript" charset="utf-8">
      relpath = '';
      if (relpath != '') relpath += '/';
    </script>

    <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/app.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/highlight.pack.js"></script>
    <script type="text/javascript" charset="utf-8">
      hljs.initHighlightingOnLoad();
      hljs.configure({languages: []}); //disable autodetect
    </script>
  </head>

  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>

    <section id="content">
      <div class="breadcrumbs">hub v0.9.0 &rarr; <a href="overview.html">Overview</a> &rarr; <a href="Hub.html">Hub</a></div>
      <h1>
        Hub
        
      </h1>

      <ul class="summary_links">
        
          <li><a href="#summary">Summary</a></li>
        
        
        
          <li><a href="#functions_details">Functions</a></li>
        
        
        
      </ul>

      
        <section id="moduledoc" class="docstring">
          <p> Central state cache and update broker</p>
<p> Implements a heirarchial key-value store with publish/watch semanitcs
 at each node of the heirarchy.   Plans to support timestamping,
 version stamping, real-time playback, security,</p>
<p> The hub holds a collection of dnodes (dictionary nodes).  Each dictionary
 node is a key/value store, where the keys are atoms, and the values
 are any erlang term.  Sometimes the value is also a dnode, which results
 in a heirarchy.</p>
<p> Processes publish state on a hub, watch to state changes,
 request information about the state of the bus, and request changes
 to the state.</p>
<p> A hub is a process (a gen_server, actually) that holds state for the
 system, manages changes to state, and and routes notifications of
 changes of state.</p>
<p> The hub keeps a sequence ID for each change to state, and this is
 stored as part of the state graph, so that the hub can answer the
 question:  “show me all state that has changed since sequence XXX”</p>
<p> <strong> Limitations and areas for improvement </strong></p>
<p> Right now the store is only in memory, so a restart removes all data
 from the store.   All persistence must be implemented separately</p>
<p> There is currently no change history or playback history feature.</p>
<p> [{key,val},{key,val}...]</p>
<p> if a value at any given path is a proplist (tested as a list whose first
 term is a tuple, or an empty list).</p>
<p> some special keys that can appea</p>
<p>  mgr@        list of dependents in charge of point in graph
  wch@        list of dependents to be informed about changes</p>
<p> For convenience, you can pass in keys as atoms, but they will be converted
 to binary keys internally (all keys are stored as binaries).    They will
 be represented as binary keys when returned.  This behavior is under review
 so if you want to be sure, pass binary keys to begin with.</p>
<p> ## Examples</p>
<p> Basic Usage:</p>
<pre><code class="elixir"># Start the Hub GenServer
 iex&gt; Hub.start
 {:ok, #PID&lt;0.127.0&gt;}
 # Put [status: :online] at path [:some, :point]
 iex(2)&gt; Hub.put [:some,:point], [status: :online]
 {:changes, {&quot;05142ef7fe86a86D2471CA6869E19648&quot;, 1},
 [some: [point: [status: :online]]]}
 # Fetch all values at path [:some, :point]
 Hub.fetch [:some, :point]
 {{&quot;05142ef7fe86a86D2471CA6869E19648&quot;, 1}, [status: :online]}
 # Get particular value :status at [:some, :point]
 Hub.get [:some, :point], :status
 :online</code></pre>

        </section>
      

      
        <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L1" class="view_source">Source</a>
      

      
        <h2 id="summary">Summary<span class="detail_header_links"><a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a></span></h2>
        <table class="summary">
          <tr>
  <td class="summary_signature"><a href="#agent/1">agent(path)</a></td>
  
    <td class="summary_synopsis"><p>Returns the controlling agent for this path, or nil if none</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#deltas/2">deltas(seq, path \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Gets the changes from the provided sequence counter on the path to its current
state</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#dump/1">dump(path \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Dumps the entire contents of the hub graph, including “non human” information</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#fetch/1">fetch(path \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Gets all the “human readable” key values pairs at the specified path</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#get/2">get(path, key)</a></td>
  
    <td class="summary_synopsis"><p>Gets the value at the specified path with the specified key</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#manage/2">manage(path, options \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Similar to <a href="#master/2"><code class="inline">master/2</code></a> but does not <code class="inline">watch</code> the path</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#manager/1">manager(path)</a></td>
  
    <td class="summary_synopsis"><p>Retrieves the manager with options for the provided path</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#master/2">master(path, options \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Associate the currrent process as the primary agent for the given
path.  This binds/configures this process to the hub, and also sets
the path as the “agent path” in the process dictionary</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#pt_to_url/1">pt_to_url(pt)</a></td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#put/2">put(path, changes)</a></td>
  
    <td class="summary_synopsis"><p>Same as <a href="#update/3"><code class="inline">update/3</code></a> except no context argument. See <a href="#update/3"><code class="inline">update/3</code></a> for more
information</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#request/3">request(path, request, context \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Request a change to the path in the hub. The Manager is forwarded the request
and is responsible for handling it. If no manager is found a timeout will
occur</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#start/2">start(, )</a></td>
  
    <td class="summary_synopsis"><p>Start the Hub GenServer</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#start_link/2">start_link(, )</a></td>
  
    <td class="summary_synopsis"><p>Start the Hub GenServer with link to calling process</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#unwatch/1">unwatch(path)</a></td>
  
    <td class="summary_synopsis"><p>Removes the calling process from the @wch list of process to stop getting
notified of changes to the path specified</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#update/3">update(path, changes, context \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Updates the path with the changes provided</p>
</td>
  
</tr>
<tr>
  <td class="summary_signature"><a href="#watch/2">watch(path, options \\ [])</a></td>
  
    <td class="summary_synopsis"><p>Adds the calling process to the @wch list of process to get notified of
changes to the path specified</p>
</td>
  
</tr>

        </table>
      

      

      
        <section id="functions_details" class="details_list">
          <h2>Functions</h2>
          <section class="detail">
  <div class="detail_header" id="agent/1">
    <span class="signature"><strong>agent(path)</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#agent/1" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Returns the controlling agent for this path, or nil if none</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.agent [:some, :point]
#PID&lt;0.125.0&gt;</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L201" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="deltas/2">
    <span class="signature"><strong>deltas(seq, path \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#deltas/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Gets the changes from the provided sequence counter on the path to its current
state.</p>
<p>The sequence counter is retured on calls to <code class="inline">get/1</code>, <a href="#put/2"><code class="inline">put/2</code></a>, <a href="#update/3"><code class="inline">update/3</code></a>,
<a href="#dump/1"><code class="inline">dump/1</code></a>, <a href="#fetch/1"><code class="inline">fetch/1</code></a></p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.deltas {&quot;05142f977e209de63a768684291be964&quot;, 1}, [:some, :path]
{{&quot;05142f977e209de63a768684291be964&quot;, 2}, [some: :new_data]}

iex&gt; Hub.deltas {:undefined, 0}, [:some, :path]
#Returns all changes</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L291" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="dump/1">
    <span class="signature"><strong>dump(path \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#dump/1" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Dumps the entire contents of the hub graph, including “non human” information.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.dump
{{&quot;05142ef7fe86a86D2471CA6869E19648&quot;, 1},
  [some: {1, [point: {1, [mgr@: {#PID&lt;0.125.0&gt;, []}, some: {1, :data}]}]}]}</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L246" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="fetch/1">
    <span class="signature"><strong>fetch(path \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#fetch/1" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Gets all the “human readable” key values pairs at the specified path.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt;Hub.fetch [:some, :point]
{{&quot;05142ef7fe86a86D2471CA6869E19648&quot;, 1}, [some: :data]}</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L273" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="get/2">
    <span class="signature"><strong>get(path, key)</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#get/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Gets the value at the specified path with the specified key.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.get [:some, :point], :status
:online</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L259" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="manage/2">
    <span class="signature"><strong>manage(path, options \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#manage/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Similar to <a href="#master/2"><code class="inline">master/2</code></a> but does not <code class="inline">watch</code> the path.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.manage [:some, :point], []
:ok</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L174" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="manager/1">
    <span class="signature"><strong>manager(path)</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#manager/1" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Retrieves the manager with options for the provided path.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.manager [:some, :point]
{:ok, {#PID&lt;0.125.0&gt;, []}}</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L188" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="master/2">
    <span class="signature"><strong>master(path, options \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#master/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Associate the currrent process as the primary agent for the given
path.  This binds/configures this process to the hub, and also sets
the path as the “agent path” in the process dictionary.</p>
<p><em>Note:</em> The path provided must exist and have values stored before trying
to master it.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.master [:some, :point]
:ok</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L157" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="pt_to_url/1">
    <span class="signature"><strong>pt_to_url(pt)</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#pt_to_url/1" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    
  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L573" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="put/2">
    <span class="signature"><strong>put(path, changes)</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#put/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Same as <a href="#update/3"><code class="inline">update/3</code></a> except no context argument. See <a href="#update/3"><code class="inline">update/3</code></a> for more
information</p>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L139" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="request/3">
    <span class="signature"><strong>request(path, request, context \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#request/3" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Request a change to the path in the hub. The Manager is forwarded the request
and is responsible for handling it. If no manager is found a timeout will
occur.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.request [:some, :point], [useful: :info]
{:changes, {&quot;0513b7725c5436E67975FB3A13EB3BAA&quot;, 2},
 [some: [point: [useful: :info]]]}</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L115" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="start/2">
    <span class="signature"><strong>start(, )</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#start/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Start the Hub GenServer</p>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L91" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="start_link/2">
    <span class="signature"><strong>start_link(, )</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#start_link/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Start the Hub GenServer with link to calling process</p>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L96" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="unwatch/1">
    <span class="signature"><strong>unwatch(path)</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#unwatch/1" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Removes the calling process from the @wch list of process to stop getting
notified of changes to the path specified.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.unwatch [:some, :point]
:ok</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L232" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="update/3">
    <span class="signature"><strong>update(path, changes, context \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#update/3" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Updates the path with the changes provided.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.update [:some, :point], [some: :data]
{:changes, {&quot;05142ef7fe86a86D2471CA6869E19648&quot;, 1},
 [some: [point: [some: :data]]]}</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L131" class="view_source">Source</a>
  
</section>
<section class="detail">
  <div class="detail_header" id="watch/2">
    <span class="signature"><strong>watch(path, options \\ [])</strong></span>
    <div class="detail_header_links">
      <span class="detail_type">(function)</span>
      <a href="#watch/2" class="detail_link" title="Link to this function">#</a>
      <a class="to_top_link" href="#content" title="To the top of the page">&uarr;</a>
    </div>
  </div>
  
  <section class="docstring">
    <p>Adds the calling process to the @wch list of process to get notified of
changes to the path specified.</p>
<h2>Examples</h2>
<pre><code class="iex elixir">iex&gt; Hub.watch [:some, :point]
:ok</code></pre>

  </section>
  
    <a href="https://github.com/cellulose/hub/blob/master/lib/hub.ex#L218" class="view_source">Source</a>
  
</section>

        </section>
      

      

      
    </section>
  </body>
</html>
